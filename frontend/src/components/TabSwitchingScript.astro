<script>
  function initTabs() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanels = document.querySelectorAll('.tab-panel');

    console.log('[TabSwitching] Initializing tabs...', {
      buttons: tabButtons.length,
      panels: tabPanels.length
    });

    if (tabButtons.length === 0) {
      console.error('[TabSwitching] No tab buttons found!');
      return;
    }

    tabButtons.forEach(button => {
      const newButton = button.cloneNode(true);
      button.parentNode?.replaceChild(newButton, button);
    });

    const freshTabButtons = document.querySelectorAll('.tab-button');
    const freshTabPanels = document.querySelectorAll('.tab-panel');

    freshTabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const targetTab = button.getAttribute('data-tab');
        console.log('[TabSwitching] Tab clicked:', targetTab);

        if (!targetTab) {
          console.warn('[TabSwitching] Tab button missing data-tab attribute');
          return;
        }

        freshTabButtons.forEach(btn => btn.classList.remove('active'));
        freshTabPanels.forEach(panel => panel.classList.remove('active'));

        button.classList.add('active');
        const targetPanel = document.querySelector(`[data-panel="${targetTab}"]`);
        if (targetPanel) {
          targetPanel.classList.add('active');
        }

        sessionStorage.setItem('activeTab', targetTab);
      });
    });

    const savedTab = sessionStorage.getItem('activeTab');
    if (savedTab && !document.querySelector('.tab-button.active')) {
      const savedButton = document.querySelector(`[data-tab="${savedTab}"]`) as HTMLElement | null;
      if (savedButton) {
        savedButton.click();
      }
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTabs);
  } else {
    initTabs();
  }

  document.addEventListener('astro:page-load', initTabs);
</script>
